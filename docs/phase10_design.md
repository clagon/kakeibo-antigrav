# Phase 10: ブラッシュアップ

本フェーズでは、アプリの利便性と完成度を高めるための各種機能追加と調整を行います。

## Proposed Changes

### 1. CSV インポート・エクスポート機能
入力した家計簿データを CSV 形式で出力（エクスポート）および取り込み（インポート）できるようにします。
データのインポート・エクスポート画面は、設定のサブ画面として独立した新しいルート（`/settings/backup`、画面名は「データバックアップ（CSV）」等）を作成します。

#### 新規作成
- **`src/routes/api/export/+server.ts`**: DB上の明細データを取得し、CSV文字列を生成して返す GET エンドポイント。
- **`src/routes/api/import/+server.ts`**: CSVファイルを受け取り、解析してDBに明細データを挿入する POST エンドポイント。
  - **カテゴリの判定規則**: 新規のカテゴリー名が含まれていた場合は、自動的に新規作成して登録します。カテゴリーが空（または未指定）の場合は、「未分類」というカテゴリーを自動生成し、それに割り当てる仕様とします。
  - **レシート（トランザクション）の扱い**: 完全な復元を可能にするため、CSVに「レシートID」を含めます。インポート時は**同じ「レシートID」の明細行**を1つのレシートとしてまとめて登録します。レシートIDの列がない（または空の）外部データの場合は、従来通り「同じ日付」かつ「同じ収支区分」の行を1つのレシートに集約してフォールバック処理します。

#### CSV形式（フォーマット）
1行目をヘッダーとし、以下の形式を採用します。
```csv
レシートID,日付,収支区分,レシートメモ,カテゴリー,金額,明細メモ
550e8400-e29b-41d4-a716-446655440000,2026-02-22,expense,スーパーでの買い物,食費,1500,ランチ
550e8400-e29b-41d4-a716-446655440000,2026-02-22,expense,スーパーでの買い物,食費,500,お茶
bbccdd00-e29b-41d4-a716-446655440011,2026-02-22,income,,給与,300000,2月分
```
※収支区分は `expense` または `income` を指定。

#### UI 更新
- **`src/routes/settings/backup/+page.svelte`**: 「CSVバックアップ・復元」画面として新設し、「エクスポート」ボタンと「インポート（ファイル選択）」ボタンを実装。
- **`src/routes/settings/+page.svelte`**: 設定画面に「CSVバックアップ・復元」へのナビゲーションリンクを追加。

### 2. アニメーション・トランジション
ページ推移や状態変化の視覚的フィードバックを強化し、UXを向上させます。
- **リストの動き**: `LineItemList` やカテゴリ一覧の項目追加・削除に Svelte の `slide` または `fade` トランジションを付与（`animate:flip` なども活用して並び替えを滑らかに）。
- **ページ遷移**: レイアウトレベル（`<slot />` 付近）でクロスフェードなどのページ遷移アニメーションを追加（必要に応じて実装）。

### 3. レスポンシブ微調整
PCやタブレットサイズの画面でも快適に利用できるよう、レイアウトを最適化します。
- `app.css` や `PageHeader.svelte`, `BottomNav.svelte` などのメインコンテナにおける最大幅（`max-w-md` など）と中央寄せ（`margin: 0 auto`）の適用を再確認し、デスクトップ環境で余白が間伸びしないように調整します。
- 必要に応じて、カレンダー画面のグリッド等の調整。

### 4. PWA (Progressive Web App) 対応
スマートフォンに「アプリとしてインストール」できるようにします。
- **`static/manifest.json`**: アプリ名、アイコン、テーマカラーなどの定義ファイルを作成。
- **`static/service-worker.js`**: オフラインでの基本動作キャッシュ（今回は最低限の対応）のために、サービスワーカーを追加（手動、または VITE のプラグイン）。今回は依存を減らすため手動による最低限のキャッシュ登録（オフライン時フォールバック）を想定します。
- **`src/app.html`**: `<link rel="manifest" href="%sveltekit.assets%/manifest.json" />` および `theme-color` 等のメタタグを追記。
- **アプリアイコン**: `static/` ディレクトリに仮のもの（四角に文字などのプレースホルダー）を配置します。

## User Review Required
> [!IMPORTANT]
> - Phase の番号について、直前のタスク「明細編集機能」を Phase 9 として進めたため、本フェーズを「Phase 10: ブラッシュアップ」として定義しています。この内容で進めてよろしいでしょうか？

## Verification Plan
### 自動テスト
- `npm run lint` および `npm run build` によるエラー確認。

### 手動検証
- 設定画面のエクスポートボタンを押して、明細データが CSV 形式でダウンロードされること。
- そのCSVファイルを選択してインポートし、データが正しくDBに追加される（画面上で確認可能である）こと。
- 各リスト要素（追加・削除時）でトランジションアニメーションが動作すること。
- PCサイズのブラウザ幅にしたとき、画面が間伸びせず中央（スマホ幅程度）に適切に配置されているか。
- Chrome等のブラウザ開発者ツール（Applicationタブ）で Manifest と Service Worker が認識され、インストール可能になっているか。
