# Phase 5: カレンダー画面（Calendar Screen）設計書

## 1. 目的と概要
カレンダー形式で日々の支出・収入を一覧表示し、月間の収支状況を視覚的に把握できる画面を実装します。どの日にお金を使ったか、または入ってきたかが一目でわかる UI を目指します。

## 2. 画面レイアウト構成

### ヘッダー領域
- **年月ナビゲーション**: 中央に「2026年 2月」のように表示。左右の「◀」「▶」ボタンで前月・翌月へ切り替え。
- **月間サマリー**: ヘッダー下部に、その月の「収入合計」「支出合計」「収支（残金）」を並べて分かりやすく表示。

### カレンダーグリッド領域
- 設定により週の始まり（日曜/月曜など）を変更できるようにする。**現状は月曜始まり決め打ち**で実装。
- 各日付のセルに表示する情報：
  - 日付の数字
  - その日の「収入合計（例: `+¥5000` 青字）」 ※表示位置は上段
  - その日の「支出合計（例: `-¥1200` 赤字）」 ※表示位置は下段
  - ※ 金額がゼロの日は数字のみ表示してスッキリさせる。

### レシート一覧領域（カレンダー下部）
- カレンダーグリッドの直下に、その月の「レシート（取引）一覧」を**最新の日付順（降順）**で表示する。
- **日ごとの区切り（ディバイダー）**:
  - ディバイダー内に「月日曜日」と「その日の収支合計」を表示。
- **レシート行機能**:
  - 通常表示：メモと金額を表示。
  - **クリック（タップ）**: アコーディオンが開閉し、レシートに紐づく**明細（カテゴリ＋アイコン、メモ、金額）**を一覧表示する。（※アコーディオンは**排他制御**とし、一つ開いたら他は閉じる仕様）
  - **長押し**: 入力画面へ遷移し、該当レシートの編集を行う。

### 日付タップ時の挙動
- カレンダーの日付セルをタップすると、画面下部にある**「対象日のレシート一覧の該当箇所（ディバイダー部分）」へ自動スクロール**する。

---

## 3. 必要なコンポーネントと API

### 新規コンポーネント
- `CalendarGrid.svelte`
  - 役割：指定年月と週の始まりを元にカレンダーグリッドを描画する。
  - Props: `year`, `month`, `startOfWeek` (0: 日曜, 1: 月曜), `dailyData` (各日の収支データ), `onDayClick`。
- `MonthSummary.svelte`
  - 役割：月間の収入・支出・収支の合計を表示。
- `ReceiptList.svelte` (または `ReceiptAccordion.svelte`)
  - 役割：日ごとのディバイダーとレシートのリスト、アコーディオンによる明細表示を担当。

### 新規 API サブパス (例)
カレンダー描画用と、特定日の詳細取得用でエンドポイントを検討。
- **`GET /api/receipts/summary?year=2026&month=2`**
  - レスポンス: その月の「月間合計（収入/支出）」と「日別合計（1日〜末日までの配列）」を返す。これによりカレンダーグリッドとサマリーを一気に描画可能。
- **`GET /api/receipts/daily?date=2026-02-22`**
  - レスポンス: 指定した日付の LineItem の詳細リストを返す。（ドロワー開閉時に取得）

---

## 4. UI/UX のポイント
- **スワイプ対応**: カレンダーグリッド部分を左右にスワイプして前月・翌月に移動できるようにすると、スマホアプリらしい操作感になります。
- **現在日の強調**: 「今日」のセルは**背景色を薄くハイライトし、日付の数字を太字（bold）**にして分かりやすくします。
- **スクロール連携**: カレンダーの特定日付をタップした時に、画面下部の対象日のリストへスムーズにスクロールするようにします。
- **ローディング状態**: 月を切り替えた際のデータフェッチ中は、金額部分をスケルトンローディング表示するなどして体感速度を向上。
